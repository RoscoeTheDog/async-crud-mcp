{
  "story_id": "4",
  "phase": "a",
  "status": "passed",
  "completed_at": "2026-02-17T08:12:20Z",
  "planning_output": {
    "implementation_plan": "Align the interactive menu in scripts/installer.py to match the spec ordering: 1=Install, 2=Reinstall, 3=Uninstall, 4=Quit. The 'Test' option is removed from the menu and replaced with 'Reinstall'. The 'Exit' label becomes 'Quit'. A new do_reinstall() function implements stop-existing-service + force-reinstall logic.\n\nKey changes:\n1. Add a stop_service() helper function in installer.py that stops the platform service (mirrors the stop logic from uninstaller.py's stop_daemon()). Uses stdlib subprocess only.\n2. Add a do_reinstall() function that: (a) calls stop_service() to stop any running service, (b) calls do_install(force=True) which removes existing venv/config and performs a fresh install (which includes service installation at the end).\n3. Rewrite show_menu() to display the four spec-compliant options in correct order and route to the correct handler functions.\n4. The CLI argparse subcommand 'test' and 'do_test()' function remain available for CLI usage but are no longer in the interactive menu.",
    "files_to_modify": [
      "scripts/installer.py"
    ],
    "estimated_complexity": "low",
    "ac_breakdown": {
      "AC-4.1": "Menu option 1 already displays 'Install' and calls do_install(). Just ensure it remains option 1 in the reordered menu. Label: '1. Install async-crud-mcp'. No logic changes needed for this option.",
      "AC-4.2": "Add new do_reinstall() function and stop_service() helper. do_reinstall() calls stop_service() to stop existing daemon, then calls do_install(force=True) which removes existing venv/config and performs fresh install including service installation. stop_service() uses subprocess to call platform-appropriate service stop commands (sc stop AsyncCrudMCP on Windows, systemctl --user stop async-crud-mcp on Linux, launchctl unload on macOS). Menu option 2 label: '2. Reinstall async-crud-mcp'. Route choice '2' to do_reinstall().",
      "AC-4.3": "Move Uninstall from option 2 to option 3. Label: '3. Uninstall async-crud-mcp'. Route choice '3' to do_uninstall(). No logic changes to do_uninstall() itself.",
      "AC-4.4": "Replace 'Exit' (was option 4) with 'Quit'. Label: '4. Quit'. Route choice '4' to print '[INFO] Quitting' and return EXIT_SUCCESS. Also update the invalid choice message to 'Please enter 1-4'."
    },
    "testing_strategy": "No existing tests cover show_menu() (confirmed by grep). The changes are interactive-menu-only and all underlying functions (do_install, do_uninstall) are unchanged. Manual verification: run 'python scripts/installer.py menu' and confirm the four options display correctly. The new do_reinstall() and stop_service() functions use the same subprocess patterns as existing code. Existing test suite should continue passing since no behavioral changes to install/uninstall logic.",
    "dependencies": [
      "Story 7 (Rename bootstrap_service.py to windows_service.py) - must complete first per queue dependency"
    ]
  }
}
