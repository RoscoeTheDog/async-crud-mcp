{
  "story_id": "3",
  "phase": "a",
  "status": "passed",
  "completed_at": "2026-02-13T09:15:00Z",
  "planning_output": {
    "implementation_plan": "Add all missing CLI options to bootstrap_cmd.py per the CLI_COMMANDS.template.md spec. The current file has 6 bare commands with no options. Each command needs Typer Option parameters added, and the function bodies need to pass those options through to the installer. Since story 11 (enhance installer.py) is not yet complete, the installer interface (InstallerBase) does not yet have is_admin(), elevate_and_rerun(), get_state(), service_name property, or list_all_services(). Therefore: (1) For admin checks (AC-3.6), implement a standalone is_admin() helper in bootstrap_cmd.py using ctypes on Windows (ctypes.windll.shell32.IsUserAnAdmin) that works independently of the installer. For elevation, print an error message directing the user to run as admin rather than auto-elevating (which requires ShellExecute and is installer territory). (2) For --username, pass it to get_installer() only if the installer accepts it; otherwise store it for future use when story 11 lands. Since get_installer() currently takes no args, we need to add a minimal username parameter to get_installer() and have InstallerBase store it, OR we pass username through to the installer methods. The simplest approach: add an optional username parameter to get_installer() that is stored on the instance but not used yet by the platform implementations. (3) For --force on install, pass it as a kwarg to installer.install(force=force). The WindowsServiceInstaller.install() already accepts **kwargs and passes them to install_service(**kwargs). (4) For --use-task-scheduler on install, pass it as force_task_scheduler kwarg. (5) For --json on status, format output as JSON dict. (6) For --force on uninstall, skip confirmation prompt. (7) Update list command to show per-user info with username/status columns.\n\nKey design decisions:\n- Admin check: standalone ctypes-based function in bootstrap_cmd.py (Windows-only, no-op on other platforms)\n- username: Add optional username param to get_installer() factory; store on InstallerBase.__init__(); platform impls ignore for now\n- Tests: Update existing tests to cover new options; add new tests for each option combination",
    "files_to_modify": [
      "src/async_crud_mcp/cli/bootstrap_cmd.py",
      "src/async_crud_mcp/daemon/installer.py",
      "tests/test_cli/test_bootstrap_cmd.py"
    ],
    "estimated_complexity": "medium",
    "ac_breakdown": {
      "AC-3.1": "Add --force/-f (bool, default False) and --use-task-scheduler (bool, default False) options to the install() command using typer.Option. Pass force=force to installer.install() and force_task_scheduler=use_task_scheduler to get_installer(). The WindowsServiceInstaller.install() already accepts **kwargs which forwards to install_service(), so --force will flow through. For --use-task-scheduler, store it on the installer instance for future use by the platform-specific backends.",
      "AC-3.2": "Add --username/-u (Optional[str], default None) and --force/-f (bool, default False) options to uninstall(). When --force is False, prompt for confirmation using typer.confirm(). Pass username to get_installer(username=username). Call installer.stop() before installer.uninstall() to match the spec pattern (stop-then-uninstall).",
      "AC-3.3": "Add --username/-u (Optional[str], default None) option to start(). Pass username to get_installer(username=username). The installer will eventually use this to target a specific user's service instance.",
      "AC-3.4": "Add --username/-u (Optional[str], default None) option to stop(). Pass username to get_installer(username=username). Same pattern as start.",
      "AC-3.5": "Add --username/-u (Optional[str], default None) and --json/-j (bool, default False) options to status(). When --json is True, output a JSON dict with service_name, status, and username fields using json.dumps(). Pass username to get_installer(username=username).",
      "AC-3.6": "Create a _check_admin() helper function in bootstrap_cmd.py. On Windows (sys.platform == 'win32'), use ctypes.windll.shell32.IsUserAnAdmin() to check admin privileges. On other platforms, check os.geteuid() == 0. Call _check_admin() at the start of install() and uninstall() commands. If not admin, print error message '[red]Admin privileges required. Please run as administrator.[/red]' and raise typer.Exit(code=1). Also need to update get_installer() in installer.py to accept optional username parameter and store it on the InstallerBase instance."
    },
    "testing_strategy": "Update test_bootstrap_cmd.py with tests for: (1) install with --force flag passes force=True to installer.install(); (2) install with --use-task-scheduler flag; (3) uninstall with --username passes username through; (4) uninstall with --force skips confirmation; (5) uninstall without --force prompts for confirmation; (6) start/stop with --username; (7) status with --json outputs valid JSON; (8) status with --username; (9) admin check blocks install when not admin (mock ctypes/os); (10) admin check blocks uninstall when not admin. All tests use unittest.mock to patch get_installer and the admin check helper. Use typer.testing.CliRunner for CLI invocation.",
    "dependencies": []
  }
}
