C:\Users\Admin\AppData\Roaming\Python\Python313\site-packages\web3\__init__.py:2: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\Admin\Documents\GitHub\async-crud-mcp
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.0, langsmith-0.4.37, asyncio-1.3.0, cov-7.0.0, httpx-0.36.0, json-report-1.5.0, metadata-3.1.1, timeout-2.4.0, web3-6.11.2
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 412 items

tests\test_cli\test_bootstrap_cmd.py ......                              [  1%]
tests\test_cli\test_config_cmd.py ............                           [  4%]
tests\test_cli\test_daemon_cmd.py .............                          [  7%]
tests\test_cli\test_install_cmd.py .............                         [ 10%]
tests\test_cli\test_setup_cmd.py ..............                          [ 14%]
tests\test_config.py .......................................             [ 23%]
tests\test_daemon_paths.py .....ss..s...............                     [ 29%]
tests\test_diff_engine.py ..................................             [ 37%]
tests\test_file_io.py ..................s.....                           [ 43%]
tests\test_file_watcher.py ...F..............                            [ 48%]
tests\test_lock_manager.py .................                             [ 52%]
tests\test_path_validator.py ...........sss.........                     [ 57%]
tests\test_persistence.py ...........                                    [ 60%]
tests\test_scripts\test_test_server.py ........................          [ 66%]
tests\test_server.py .................                                   [ 70%]
tests\test_tools\test_async_append.py ..............                     [ 73%]
tests\test_tools\test_async_batch_read.py ......                         [ 75%]
tests\test_tools\test_async_batch_update.py .......                      [ 76%]
tests\test_tools\test_async_batch_write.py .......                       [ 78%]
tests\test_tools\test_async_delete.py ........                           [ 80%]
tests\test_tools\test_async_list.py .............                        [ 83%]
tests\test_tools\test_async_read.py ............                         [ 86%]
tests\test_tools\test_async_rename.py ............                       [ 89%]
tests\test_tools\test_async_status.py ............                       [ 92%]
tests\test_tools\test_async_update.py .....................              [ 97%]
tests\test_tools\test_async_write.py ..........                          [100%]

================================== FAILURES ===================================
____________ TestDebounceCoalesceLogic.test_single_event_debounced ____________

self = <tests.test_file_watcher.TestDebounceCoalesceLogic object at 0x0000023CBA93D590>
tmp_path = WindowsPath('C:/Users/Admin/AppData/Local/Temp/pytest-of-Admin/pytest-1646/test_single_event_debounced0')

    def test_single_event_debounced(self, tmp_path):
        """Test that single event is processed after debounce window."""
        registry = HashRegistry()
        test_file = tmp_path / "test.txt"
        test_file.write_text("initial content", encoding='utf-8')
    
        # Register file so watcher will update it
        from async_crud_mcp.core.file_io import compute_file_hash
        initial_hash = compute_file_hash(str(test_file))
        registry.update(str(test_file), initial_hash)
    
        watcher = FileWatcher(
            base_directories=[str(tmp_path)],
            registry=registry,
            enabled=True,
            debounce_ms=100,
        )
    
        try:
            watcher.start()
    
            # Modify file
            test_file.write_text("modified content", encoding='utf-8')
    
            # Wait for debounce window + processing
            time.sleep(0.3)
    
            # Hash should be updated
            new_hash = registry.get(str(test_file))
>           assert new_hash != initial_hash
E           AssertionError: assert 'sha256:916a3f0bc3a428e1a168f4408df82cd5bbb8b08c6d7ac55eff9dff29825134df' != 'sha256:916a3f0bc3a428e1a168f4408df82cd5bbb8b08c6d7ac55eff9dff29825134df'

tests\test_file_watcher.py:69: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_file_watcher.py::TestDebounceCoalesceLogic::test_single_event_debounced
============ 1 failed, 404 passed, 7 skipped in 195.23s (0:03:15) =============
