{
  "partition_id": 1,
  "gap_summary": {
    "total_deliverables": 87,
    "new": 0,
    "modify": 3,
    "done": 84,
    "extra": 0
  },
  "stories": [
    {
      "id": "1",
      "title": "Fix installer.py service installation to use venv CLI bootstrap pattern",
      "type": "feature",
      "description": "CRITICAL BUG: scripts/installer.py install_service() function (line 252-282) looks for non-existent service_installer.bat in daemon/windows/ directory. The template spec shows it should use the venv CLI bootstrap install command pattern instead. The implementation has bootstrap_service.py with install_service() using direct CreateService API (GAP-4), but installer.py doesn't call it correctly. Must change from subprocess.run([installer_script, 'install']) to calling the venv Python executable with 'async-crud-mcp bootstrap install' command.",
      "acceptance_criteria": [
        {"id": "AC-1.1", "text": "install_service() calls venv CLI: {venv_python} -m async_crud_mcp.cli bootstrap install"},
        {"id": "AC-1.2", "text": "Removes all references to non-existent service_installer.bat"},
        {"id": "AC-1.3", "text": "Properly delegates to windows/bootstrap_service.install_service() via CLI"},
        {"id": "AC-1.4", "text": "uninstaller.py also updated to use CLI pattern (currently line 93 has same bug)"},
        {"id": "AC-1.5", "text": "Linux/macOS paths gracefully skip or error if systemd_installer.sh/launchd_installer.sh don't exist"}
      ],
      "files": ["scripts/installer.py", "scripts/uninstaller.py"],
      "depends_on": [],
      "risk": "high",
      "points": 3,
      "gap_sources": ["d28", "d29"]
    },
    {
      "id": "2",
      "title": "Expand installer.py to full template spec (~1100 lines)",
      "type": "feature",
      "description": "The scripts/installer.py is only ~540 lines vs the spec's ~1100 lines requirement. Missing: InstallerContext dataclass for state management, comprehensive step-by-step logging with [STEP X/Y] prefixes, detailed error messages with troubleshooting hints, enhanced preflight checks with detailed reporting, robust retry logic, and comprehensive docstrings. The current version has basic functionality but lacks the template's robustness, logging verbosity, and user-friendly error handling that makes troubleshooting easier.",
      "acceptance_criteria": [
        {"id": "AC-2.1", "text": "InstallerContext dataclass for managing installation state"},
        {"id": "AC-2.2", "text": "Step-by-step logging with [STEP X/Y] prefixes for all major operations"},
        {"id": "AC-2.3", "text": "Comprehensive error messages with troubleshooting hints"},
        {"id": "AC-2.4", "text": "Enhanced preflight checks with detailed pass/fail reporting"},
        {"id": "AC-2.5", "text": "Robust retry logic for network operations (uv download)"},
        {"id": "AC-2.6", "text": "Interactive menu system with Install/Reinstall/Uninstall/Quit"},
        {"id": "AC-2.7", "text": "Full docstrings matching template quality"},
        {"id": "AC-2.8", "text": "~1100 lines total matching template robustness"}
      ],
      "files": ["scripts/installer.py"],
      "depends_on": ["1"],
      "risk": "medium",
      "points": 5,
      "gap_sources": ["d28"]
    },
    {
      "id": "3",
      "title": "Enhance daemon modules with missing acceptance criteria details",
      "type": "feature",
      "description": "Review daemon modules (paths.py, config_init.py, bootstrap_daemon.py, windows/bootstrap_service.py, windows/dispatcher.py, etc.) to ensure all spec acceptance criteria are met. While most core functionality exists, some details may be missing: all XDG path helpers (XDG_CACHE_HOME), complete registry-based user profile resolution, all multi-candidate Python executable search paths, comprehensive docstrings matching template quality, and all function signatures matching spec.",
      "acceptance_criteria": [
        {"id": "AC-3.1", "text": "paths.py: XDG_CACHE_HOME support and get_cache_dir() function"},
        {"id": "AC-3.2", "text": "paths.py: _get_user_profile_path(username) via Windows registry and pywin32"},
        {"id": "AC-3.3", "text": "config_init.py: All acceptance criteria functions fully implemented"},
        {"id": "AC-3.4", "text": "bootstrap_daemon.py: All multi-candidate Python executable search paths"},
        {"id": "AC-3.5", "text": "All daemon modules have comprehensive docstrings matching template"},
        {"id": "AC-3.6", "text": "All acceptance criteria from d5-d17 verified and complete"}
      ],
      "files": [
        "src/async_crud_mcp/daemon/paths.py",
        "src/async_crud_mcp/daemon/config_init.py",
        "src/async_crud_mcp/daemon/bootstrap_daemon.py",
        "src/async_crud_mcp/daemon/config_watcher.py",
        "src/async_crud_mcp/daemon/graceful_shutdown.py",
        "src/async_crud_mcp/daemon/logging_setup.py",
        "src/async_crud_mcp/daemon/session_detector.py",
        "src/async_crud_mcp/daemon/health.py",
        "src/async_crud_mcp/daemon/installer.py",
        "src/async_crud_mcp/daemon/windows/bootstrap_service.py",
        "src/async_crud_mcp/daemon/windows/dispatcher.py",
        "src/async_crud_mcp/daemon/windows/session_detector.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 3,
      "gap_sources": ["d5", "d6", "d7", "d8", "d9", "d10", "d11", "d12", "d13", "d15", "d16", "d17"]
    }
  ],
  "uncovered_extras": [],
  "analysis_notes": {
    "summary": "Analyzed all 87 deliverables. Found 84 complete or substantially complete, 3 requiring modifications.",
    "critical_findings": [
      "installer.py references non-existent service_installer.bat (line 264) - must use venv CLI bootstrap pattern",
      "installer.py is simplified ~540 lines vs spec ~1100 lines - lacks robustness, logging, error handling",
      "daemon modules mostly complete but may be missing some acceptance criteria details (XDG_CACHE_HOME, etc.)"
    ],
    "test_files_classification": "All test files (d58-d84) classified as 'done' per CRITICAL EXCLUSION rule. Sprint gate system handles testing: Gate 2 (micro-verification per story), Gate 3 (integration testing), Gate 5 (remediation). Test files MUST be grouped with implementation modules, not standalone.",
    "deferred_lower_priority": [
      "CLI command option gaps (d18-d23): working but missing some options",
      "Config/server minor gaps (d24-d25): working but missing validation/exit code details",
      "Documentation gaps (d87, d85): adequate but could be enhanced",
      "All core/models/tools (d36-d57): complete and working"
    ],
    "drift_mapping": {
      "key_drift_a": "installer.py line 264: service_installer.bat reference - Story 1 fixes this",
      "key_drift_b": "installer.py ~540 vs ~1100 lines - Story 2 expands to template spec",
      "key_drift_c": "daemon module acceptance criteria gaps - Story 3 addresses this",
      "key_drift_d": "uninstaller.py line 93: same service_installer.bat bug - Story 1 fixes this"
    }
  }
}
