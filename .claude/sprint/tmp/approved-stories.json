{
  "stories": [
    {
      "id": "1",
      "title": "Add ProgramData fallback path to daemon logs command",
      "type": "feature",
      "description": "The daemon logs command in daemon_cmd.py does not check the ProgramData fallback path on Windows when the primary log path is not found. Per spec d24 AC-d24.5, when running in Windows service context (LocalSystem), logs may be written to %PROGRAMDATA%/async-crud-mcp/logs instead of the user's LOCALAPPDATA path. The logs command should check this alternate location.",
      "acceptance_criteria": [
        {"id": "AC-1.1", "text": "daemon logs command checks ProgramData fallback path on Windows when primary log path not found"},
        {"id": "AC-1.2", "text": "ProgramData path uses PROGRAMDATA environment variable with async-crud-mcp/logs suffix"},
        {"id": "AC-1.3", "text": "Fallback only triggers on win32 platform"}
      ],
      "files": ["src/async_crud_mcp/cli/daemon_cmd.py"],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": ["d24"],
      "drift_metadata": {
        "max_severity": "minor",
        "classification": "drifted",
        "spec_section": "CLI_COMMANDS.template.md (Daemon Commands)"
      }
    },
    {
      "id": "2",
      "title": "Add HTTP /health endpoint to server.py",
      "type": "feature",
      "description": "The spec requires a proper HTTP /health endpoint returning status, version, and uptime. Currently server.py only exposes a health_tool() as an MCP tool. A dedicated HTTP /health route should be added so external health monitors and installers can check server health without MCP client setup.",
      "acceptance_criteria": [
        {"id": "AC-2.1", "text": "HTTP GET /health endpoint returns JSON with status, version, uptime fields"},
        {"id": "AC-2.2", "text": "Health endpoint is accessible via plain HTTP (not MCP protocol)"},
        {"id": "AC-2.3", "text": "Returns 200 OK for healthy status, 503 for unhealthy"},
        {"id": "AC-2.4", "text": "scripts/test_server.py can check the HTTP /health endpoint"}
      ],
      "files": ["src/async_crud_mcp/server.py", "scripts/test_server.py"],
      "depends_on": [],
      "risk": "medium",
      "points": 3,
      "gap_sources": ["d4", "d12"],
      "drift_metadata": {
        "max_severity": "major",
        "classification": "drifted",
        "spec_section": "SERVICE.template.md + INTEGRATION.template.md (Health Check Endpoints)"
      }
    },
    {
      "id": "3",
      "title": "Fix bootstrap_daemon configure_logging retention and add console enqueue",
      "type": "feature",
      "description": "configure_logging() in bootstrap_daemon.py uses retention=3 (int, 3 files) instead of '7 days' string retention per spec. The console handler is also missing enqueue=True for async safety (ADR-005). File handler is missing gz compression.",
      "acceptance_criteria": [
        {"id": "AC-3.1", "text": "configure_logging() file handler uses retention='7 days' string format"},
        {"id": "AC-3.2", "text": "configure_logging() console handler has enqueue=True for async safety"},
        {"id": "AC-3.3", "text": "configure_logging() adds gz compression to file handler"}
      ],
      "files": ["src/async_crud_mcp/daemon/bootstrap_daemon.py"],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": ["d7"],
      "drift_metadata": {
        "max_severity": "minor",
        "classification": "drifted",
        "spec_section": "BOOTSTRAP.template.md + PYTHON_STACK.template.md (Logging Standard)"
      }
    },
    {
      "id": "4",
      "title": "Align installer.py interactive menu with spec options",
      "type": "feature",
      "description": "scripts/installer.py interactive menu shows Install/Uninstall/Test/Exit but spec expects Install/Reinstall/Uninstall/Quit as the four menu options. Align the menu items: rename 'Test' to 'Reinstall' (with stop+reinstall+restart logic), rename 'Exit' to 'Quit', and reorder to match spec ordering (1=Install, 2=Reinstall, 3=Uninstall, 4=Quit).",
      "acceptance_criteria": [
        {"id": "AC-4.1", "text": "Interactive menu option 1 is 'Install'"},
        {"id": "AC-4.2", "text": "Interactive menu option 2 is 'Reinstall' which stops existing service, reinstalls, and restarts"},
        {"id": "AC-4.3", "text": "Interactive menu option 3 is 'Uninstall'"},
        {"id": "AC-4.4", "text": "Interactive menu option 4 is 'Quit' (replaces 'Exit')"}
      ],
      "files": ["scripts/installer.py"],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": ["d28"],
      "drift_metadata": {
        "max_severity": "minor",
        "classification": "partial",
        "spec_section": "INSTALLER.template.md"
      }
    },
    {
      "id": "5",
      "title": "Enhance README with CLI usage examples and two-layer architecture overview",
      "type": "feature",
      "description": "README.md is missing explicit CLI command usage examples and the two-layer architecture overview (daemon service + MCP server). The spec requires these sections for user onboarding.",
      "acceptance_criteria": [
        {"id": "AC-5.1", "text": "README contains Quick Install section showing setup.bat / setup.sh usage"},
        {"id": "AC-5.2", "text": "README contains CLI usage examples for bootstrap, daemon, config subcommands"},
        {"id": "AC-5.3", "text": "README contains Architecture section describing two-layer design (OS service + MCP server)"},
        {"id": "AC-5.4", "text": "README describes per-user daemon model and multi-user support"}
      ],
      "files": ["README.md"],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": ["d87"],
      "drift_metadata": {
        "max_severity": "minor",
        "classification": "drifted",
        "spec_section": "README.template.md"
      }
    },
    {
      "id": "6",
      "title": "Align pyproject.toml requires-python and add missing mcp dependency",
      "type": "feature",
      "description": "pyproject.toml has requires-python='>=3.12' but spec requires '>=3.10' for broader compatibility. Also missing 'mcp>=1.0.0' from core dependencies per spec AC-d1.3. The ruff target-version should also be updated from py312 to py310 to match.",
      "acceptance_criteria": [
        {"id": "AC-6.1", "text": "requires-python = '>=3.10' in pyproject.toml"},
        {"id": "AC-6.2", "text": "mcp>=1.0.0 added to [project.dependencies]"},
        {"id": "AC-6.3", "text": "tool.ruff target-version updated from 'py312' to 'py310'"},
        {"id": "AC-6.4", "text": "All existing tests still pass with the updated config"}
      ],
      "files": ["pyproject.toml"],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": ["d1"],
      "drift_metadata": {
        "max_severity": "minor",
        "classification": "drifted",
        "spec_section": "PYPROJECT.template.md"
      }
    },
    {
      "id": "7",
      "title": "Rename bootstrap_service.py to windows_service.py per ADR-014",
      "type": "feature",
      "description": "The spec and ADR-014 require the Windows pywin32 service file to be named windows_service.py, but the project uses bootstrap_service.py. Rename the file and update all imports, references, docstrings, and documentation that reference the old name. Files affected: daemon/installer.py (2 imports), daemon/windows/__init__.py (import + docstring), daemon/windows/dispatcher.py (comment), docs/PRD.md (2 references).",
      "acceptance_criteria": [
        {"id": "AC-7.1", "text": "File renamed from src/async_crud_mcp/daemon/windows/bootstrap_service.py to windows_service.py"},
        {"id": "AC-7.2", "text": "Import in daemon/installer.py updated: from .windows.windows_service import install_service"},
        {"id": "AC-7.3", "text": "Import in daemon/installer.py updated: from .windows.windows_service import uninstall_service"},
        {"id": "AC-7.4", "text": "Import in daemon/windows/__init__.py updated: from .windows_service import (...)"},
        {"id": "AC-7.5", "text": "Docstring/comment references in __init__.py, dispatcher.py, and docs/PRD.md updated"},
        {"id": "AC-7.6", "text": "No remaining references to bootstrap_service in source code (excluding archives/sprint tmp)"}
      ],
      "files": ["src/async_crud_mcp/daemon/windows/bootstrap_service.py", "src/async_crud_mcp/daemon/installer.py", "src/async_crud_mcp/daemon/windows/__init__.py", "src/async_crud_mcp/daemon/windows/dispatcher.py", "docs/PRD.md"],
      "depends_on": [],
      "risk": "medium",
      "points": 2,
      "gap_sources": ["d15"],
      "drift_metadata": {
        "max_severity": "major",
        "classification": "drifted",
        "spec_section": "SERVICE.template.md + ADR-014"
      }
    }
  ]
}
