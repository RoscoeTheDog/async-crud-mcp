{
  "stories": [
    {
      "id": "1",
      "title": "Align pyproject.toml with spec build layout",
      "type": "feature",
      "description": "The pyproject.toml is missing the src layout configuration required by the spec. The build system should be configured for hatchling with src layout explicitly. The psutil dependency is in [project.optional-dependencies].dev instead of a separate dev section. Entry point exists and most deps are correct.",
      "acceptance_criteria": [
        {
          "id": "AC-1.1",
          "text": "Build system configured for hatchling with explicit src layout (packages = ['src/async_crud_mcp'] already present, verify wheel targets)"
        }
      ],
      "files": [
        "pyproject.toml"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": [
        "d1"
      ]
    },
    {
      "id": "2",
      "title": "Complete CLI init with top-level commands and subgroups",
      "type": "feature",
      "description": "The CLI __init__.py registers all subcommand groups but is missing: (1) setup as a direct command (not a subgroup), (2) quick-install and uninstall as top-level commands, (3) version command showing __version__. Currently setup_cmd is registered as a subgroup 'setup' and install_cmd as 'install' subgroup. Per spec, setup should be a direct command, quick-install and uninstall should be top-level, and version should display the package version.",
      "acceptance_criteria": [
        {
          "id": "AC-2.1",
          "text": "setup is a direct top-level command (not a subcommand group)"
        },
        {
          "id": "AC-2.2",
          "text": "quick-install is a top-level command"
        },
        {
          "id": "AC-2.3",
          "text": "uninstall is a top-level command"
        },
        {
          "id": "AC-2.4",
          "text": "version command exists showing __version__ from __init__.py"
        }
      ],
      "files": [
        "src/async_crud_mcp/cli/__init__.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": [
        "d18"
      ]
    },
    {
      "id": "3",
      "title": "Add missing options to bootstrap CLI commands",
      "type": "feature",
      "description": "The bootstrap_cmd.py is missing several options specified in the spec: install needs --force and --use-task-scheduler options; uninstall needs --username and --force options; start needs --username option; stop needs --username option; status needs --username and --json options; list should show active per-user workers. Also missing admin privilege check and elevation for install/uninstall.",
      "acceptance_criteria": [
        {
          "id": "AC-3.1",
          "text": "install command has --force and --use-task-scheduler options"
        },
        {
          "id": "AC-3.2",
          "text": "uninstall command has --username and --force options"
        },
        {
          "id": "AC-3.3",
          "text": "start command has --username option"
        },
        {
          "id": "AC-3.4",
          "text": "stop command has --username option"
        },
        {
          "id": "AC-3.5",
          "text": "status command has --username and --json options"
        },
        {
          "id": "AC-3.6",
          "text": "Admin privilege check and elevation for install/uninstall"
        }
      ],
      "files": [
        "src/async_crud_mcp/cli/bootstrap_cmd.py",
        "tests/test_cli/test_bootstrap_cmd.py"
      ],
      "depends_on": [],
      "risk": "medium",
      "points": 3,
      "gap_sources": [
        "d19",
        "d79"
      ]
    },
    {
      "id": "4",
      "title": "Add missing options to daemon CLI commands",
      "type": "feature",
      "description": "The daemon_cmd.py is missing several spec options: start should set daemon.enabled=true in config (currently launches process directly); stop should set daemon.enabled=false (currently unimplemented placeholder); restart should cycle enabled flag with wait; status needs --username, --all, --json options; logs needs --lines, --username, --user options. All commands should use config file mutation (ADR-003) instead of direct process control.",
      "acceptance_criteria": [
        {
          "id": "AC-4.1",
          "text": "start command sets daemon.enabled=true in config (ADR-003)"
        },
        {
          "id": "AC-4.2",
          "text": "stop command sets daemon.enabled=false in config"
        },
        {
          "id": "AC-4.3",
          "text": "restart command cycles the enabled flag with wait"
        },
        {
          "id": "AC-4.4",
          "text": "status command has --username, --all, --json options"
        },
        {
          "id": "AC-4.5",
          "text": "logs command has --follow, --lines, --username, --user options"
        },
        {
          "id": "AC-4.6",
          "text": "Logs checks ProgramData path for Windows service per-user logs"
        }
      ],
      "files": [
        "src/async_crud_mcp/cli/daemon_cmd.py",
        "tests/test_cli/test_daemon_cmd.py"
      ],
      "depends_on": [],
      "risk": "medium",
      "points": 3,
      "gap_sources": [
        "d20",
        "d80"
      ]
    },
    {
      "id": "5",
      "title": "Add missing options to config CLI commands",
      "type": "feature",
      "description": "The config_cmd.py is missing several options from the spec: init command needs --port, --no-interactive, and --username options; show command needs --username and --json options; validate should use pydantic model validation.",
      "acceptance_criteria": [
        {
          "id": "AC-5.1",
          "text": "init command has --port, --no-interactive, --username options"
        },
        {
          "id": "AC-5.2",
          "text": "show command has --username and --json options"
        },
        {
          "id": "AC-5.3",
          "text": "validate command uses pydantic model validation"
        }
      ],
      "files": [
        "src/async_crud_mcp/cli/config_cmd.py",
        "tests/test_cli/test_config_cmd.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": [
        "d21",
        "d81"
      ]
    },
    {
      "id": "6",
      "title": "Align setup wizard with spec steps",
      "type": "feature",
      "description": "The setup_cmd.py has a wizard but does not follow the spec's 6-step flow. Missing: --port, --no-interactive, --force options on the setup command itself; Step 1 prerequisites check; Step 2 auto-discover port if default in use; Step 5 configure Claude Code CLI; Step 6 verify server connectivity. Currently the wizard flow mixes config init and service install but misses the per-user directory creation, Claude Code configuration, and server verification steps. Also, 'no admin required' is not enforced.",
      "acceptance_criteria": [
        {
          "id": "AC-6.1",
          "text": "setup command has --port, --no-interactive, --force options"
        },
        {
          "id": "AC-6.2",
          "text": "Step 1: Check prerequisites"
        },
        {
          "id": "AC-6.3",
          "text": "Step 2: Find available port (auto-discover if default in use)"
        },
        {
          "id": "AC-6.4",
          "text": "Step 3: Create per-user directories (config, logs)"
        },
        {
          "id": "AC-6.5",
          "text": "Step 5: Configure Claude Code CLI"
        },
        {
          "id": "AC-6.6",
          "text": "Step 6: Verify server connectivity"
        },
        {
          "id": "AC-6.7",
          "text": "No admin required"
        }
      ],
      "files": [
        "src/async_crud_mcp/cli/setup_cmd.py",
        "tests/test_cli/test_setup_cmd.py"
      ],
      "depends_on": [],
      "risk": "medium",
      "points": 3,
      "gap_sources": [
        "d22",
        "d82"
      ]
    },
    {
      "id": "7",
      "title": "Align install commands with spec options",
      "type": "feature",
      "description": "The install_cmd.py is missing several spec-required options: quick_install needs --force, --port, --no-start options (currently only has --yes); uninstall needs --keep-config/--remove-config, --keep-logs/--remove-logs, --force options; admin check and elevation for quick-install on Windows is missing. The quick-install flow should install service, generate config, start service, enable daemon. Uses Rich console with fallback.",
      "acceptance_criteria": [
        {
          "id": "AC-7.1",
          "text": "quick_install has --force, --port, --no-start options"
        },
        {
          "id": "AC-7.2",
          "text": "uninstall has --keep-config/--remove-config, --keep-logs/--remove-logs, --force options"
        },
        {
          "id": "AC-7.3",
          "text": "Admin check and elevation for quick-install on Windows"
        },
        {
          "id": "AC-7.4",
          "text": "Uses Rich console for output with fallback"
        }
      ],
      "files": [
        "src/async_crud_mcp/cli/install_cmd.py",
        "tests/test_cli/test_install_cmd.py"
      ],
      "depends_on": [],
      "risk": "medium",
      "points": 2,
      "gap_sources": [
        "d23",
        "d83"
      ]
    },
    {
      "id": "8",
      "title": "Add port validation and from_file class method to config",
      "type": "feature",
      "description": "The config.py is missing several spec requirements: (1) Port validation: ge=1024, le=65535 or null - currently no port range validation; (2) Host validation: non-empty string; (3) Settings.from_file() class method for per-user config loading - currently only get_settings() function; (4) _strip_comment_fields() function; (5) _force_reload option on get_settings(); (6) session_poll_seconds is not in DaemonConfig defaults from spec (it exists but should be verified).",
      "acceptance_criteria": [
        {
          "id": "AC-8.1",
          "text": "Port validation: ge=1024, le=65535 or null"
        },
        {
          "id": "AC-8.2",
          "text": "Host validation: non-empty string"
        },
        {
          "id": "AC-8.3",
          "text": "Settings.from_file(config_path) class method"
        },
        {
          "id": "AC-8.4",
          "text": "get_settings() singleton accessor with _force_reload option"
        },
        {
          "id": "AC-8.5",
          "text": "_strip_comment_fields() for _/$-prefixed comment removal"
        }
      ],
      "files": [
        "src/async_crud_mcp/config.py",
        "tests/test_config.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": [
        "d24",
        "d59"
      ]
    },
    {
      "id": "9",
      "title": "Add port pre-flight exit code and security logging to server",
      "type": "feature",
      "description": "The server.py is mostly complete but has gaps: (1) Exit code 48 on EADDRINUSE (port conflict) - currently raises RuntimeError without specific exit code; (2) Localhost binding security: logs security warning for non-localhost binding - missing; (3) Health endpoint should return status, version, uptime as specified.",
      "acceptance_criteria": [
        {
          "id": "AC-9.1",
          "text": "Exit code 48 on EADDRINUSE (port conflict)"
        },
        {
          "id": "AC-9.2",
          "text": "Logs security warning for non-localhost binding"
        },
        {
          "id": "AC-9.3",
          "text": "Health endpoint returns status, version, uptime"
        }
      ],
      "files": [
        "src/async_crud_mcp/server.py",
        "tests/test_server.py"
      ],
      "depends_on": [
        "8"
      ],
      "risk": "low",
      "points": 2,
      "gap_sources": [
        "d25",
        "d60"
      ]
    },
    {
      "id": "10",
      "title": "Align paths.py APP_NAME import with ADR-009",
      "type": "feature",
      "description": "The paths.py imports APP_NAME from ..config which is correct for most purposes but the spec says 'APP_NAME set to async-crud-mcp (ADR-009 single name convention)' as a local constant. The current approach works but could break if config import fails. Also missing XDG_CACHE_HOME support mentioned in spec acceptance criteria. The _is_windows_service_context and _get_user_profile_path are present and correct. Overall well-aligned but needs XDG_CACHE_HOME.",
      "acceptance_criteria": [
        {
          "id": "AC-10.1",
          "text": "XDG compliance includes XDG_CACHE_HOME support on Linux"
        },
        {
          "id": "AC-10.2",
          "text": "APP_NAME defined locally as fallback or verified import from config"
        }
      ],
      "files": [
        "src/async_crud_mcp/daemon/paths.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": [
        "d5"
      ]
    },
    {
      "id": "11",
      "title": "Enhance installer.py with full spec features",
      "type": "feature",
      "description": "The installer.py (scripts/) is a simplified version compared to the spec's ~1100 line requirement. Missing: (1) install subcommand --force/--port options; (2) uninstall subcommand --all option; (3) Privilege checks (admin on Windows); (4) Preflight checks (Python version >= 3.10, disk space, permissions); (5) uv venv --managed-python (ADR-010); (6) pywin32 DLL configuration for Windows Service (GAP-5); (7) Direct CreateService API for service install (GAP-4); (8) Setup wizard and server tests post-install; (9) Exit codes: 0=success, 1=failed, 130=cancelled.",
      "acceptance_criteria": [
        {
          "id": "AC-11.1",
          "text": "install subcommand with --force, --port options"
        },
        {
          "id": "AC-11.2",
          "text": "uninstall subcommand with --all option"
        },
        {
          "id": "AC-11.3",
          "text": "Checks privileges (admin on Windows)"
        },
        {
          "id": "AC-11.4",
          "text": "Preflight checks (Python version >= 3.10, disk space, permissions)"
        },
        {
          "id": "AC-11.5",
          "text": "Creates venv with uv venv --managed-python (ADR-010)"
        },
        {
          "id": "AC-11.6",
          "text": "Configures pywin32 DLLs for Windows Service (GAP-5)"
        },
        {
          "id": "AC-11.7",
          "text": "Exit codes: 0=success, 1=failed, 130=cancelled"
        }
      ],
      "files": [
        "scripts/installer.py"
      ],
      "depends_on": [],
      "risk": "high",
      "points": 5,
      "gap_sources": [
        "d28"
      ]
    },
    {
      "id": "12",
      "title": "Add config_init DEFAULT_PORT alignment and session_poll_seconds",
      "type": "feature",
      "description": "The config_init.py has DEFAULT_PORT = 8720 but the spec says the placeholder should be the default port. The spec also mentions session_poll_seconds config parameter in generate_default_config. The current generate_default_config lacks session_poll_seconds. Also init_config is missing the host parameter passthrough.",
      "acceptance_criteria": [
        {
          "id": "AC-12.1",
          "text": "generate_default_config() includes session_poll_seconds"
        },
        {
          "id": "AC-12.2",
          "text": "DEFAULT_PORT matches spec default (8422 per target_project or 8720 as current)"
        }
      ],
      "files": [
        "src/async_crud_mcp/daemon/config_init.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": [
        "d11"
      ]
    },
    {
      "id": "13",
      "title": "Add --port, --skip-logs, --log-age to test_server.py",
      "type": "feature",
      "description": "The scripts/test_server.py is missing CLI options specified in spec: --port for custom port, --skip-logs to skip log file age check, --log-age for max log age. Currently it hardcodes port 8765 and has no log age checking. Also needs clear pass/fail output improvement.",
      "acceptance_criteria": [
        {
          "id": "AC-13.1",
          "text": "--port option for custom port"
        },
        {
          "id": "AC-13.2",
          "text": "--skip-logs option to skip log file age check"
        },
        {
          "id": "AC-13.3",
          "text": "--log-age option for max log age"
        },
        {
          "id": "AC-13.4",
          "text": "Clear pass/fail output"
        }
      ],
      "files": [
        "scripts/test_server.py"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": [
        "d33"
      ]
    },
    {
      "id": "14",
      "title": "Enhance README with full spec documentation",
      "type": "feature",
      "description": "The README.md has basic content but is missing significant spec requirements: (1) Installation instructions referencing setup.bat/setup.sh; (2) Usage examples for CLI commands (bootstrap, daemon, config, setup, install); (3) Architecture overview with two-layer design (bootstrap layer + MCP server layer). Currently just has a brief overview and basic getting started.",
      "acceptance_criteria": [
        {
          "id": "AC-14.1",
          "text": "Installation instructions (quick install, setup.bat/setup.sh)"
        },
        {
          "id": "AC-14.2",
          "text": "Usage examples for CLI commands"
        },
        {
          "id": "AC-14.3",
          "text": "Architecture overview with two-layer design"
        }
      ],
      "files": [
        "README.md"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 2,
      "gap_sources": [
        "d87"
      ]
    },
    {
      "id": "15",
      "title": "Add .ruff_cache to .gitignore",
      "type": "feature",
      "description": "The .gitignore is missing the .ruff_cache/ pattern specified in the acceptance criteria. All other required patterns are present.",
      "acceptance_criteria": [
        {
          "id": "AC-15.1",
          "text": ".gitignore includes .ruff_cache/ pattern"
        }
      ],
      "files": [
        ".gitignore"
      ],
      "depends_on": [],
      "risk": "low",
      "points": 1,
      "gap_sources": [
        "d85"
      ]
    }
  ]
}